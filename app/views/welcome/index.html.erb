<!DOCTYPE html>
<html>
<%# link to css and bootstrap stylesheet %>
<head>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
      <title>ValetBike: Small Freedom with Two Wheels</title>
</head>


<body>
  <div class=header></div>
  <div class ="header">
    <div class="inner_header">
      <div class="logo_container">
        <a class="navbar_logo" href="index.html"><h1>VALET<span>BIKE</span></h1></a>
      </div>
      <ul class="navigation">
        <%= link_to('About', about_path, class: 'index-link') %> 
        <%= link_to('Service', service_path, class: 'index-link')  %>

        <% if logged_in? %>
          <%= link_to('Profile', current_user, class: 'index-link') %>
          <%= link_to('Log Out', logout_path, class: 'index-link') %>
          
        <% else %>
          <%= link_to('Log in', sign_in_path, class: 'index-link') %>
          <%= link_to('Sign up', sign_up_path, class: 'index-link') %>
        <% end %>
      </ul>
    </div>
  </div>

  <div class="panel_for_welcome_message">
    <div class="welcome_message"> <h1>Ride With the Wind, Share Your Freedom </h1></div>  
  <div>

 
  <%# <div class="page-section flexbox vertical stretch">
    <div class="section-inner flexbox vertical stretch">
      <div class="section-title">
        Welcome to our website : <em> ValetBike </em>!
      </div>  
      <div>
        
        <ul class = "navbar">
          <b> <font size="+2"><h2><a href="/"> Home </a> &nbsp;
          <a href="#Services"> Services </a>&nbsp;
          <a href="/about"> About  </a>&nbsp;</h2></font></b>
          <%= link_to('Sign In', sign_in_path ) %>
        <%# </ul>
      </div> %> 
      

  <div class="jumbotron">
    <div class="container-fluid">
        <p>Start Riding</p>
        <form class="form-horizontal">
            <div class="form-group">
                <label for="from" class="col-xs-2 control-label"><i class="far fa-dot-circle"></i></label>
                <div class="col-xs-4">
                    <input type="text" id="from" placeholder="Origin" class="form-control">
                </div>
          </div>
          <div class="form-group">
            
                <label for="to" class="col-xs-2 control-label"><i class="fas fa-map-marker-alt"></i></label>
                <div class="col-xs-4">
                    <input type="text" id="to" placeholder="Destination" class="form-control">
                </div>
              
            </div>
            
        </form>

        <div class="form-group">
            <button class="btn btn-info btn-lg " onclick="calcRoute();"><i class="fas fa-map-signs"></i>Go</button>
        </div>
    </div>
    <div class="container-fluid">
        <div id="googleMap"></div>
        <div id="output"></div>
    </div>
  </div>
    

  <div>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDfTjL083Zn1BlzvCMq1xOv_M53aYGFIZU&libraries=places"></script>
    <script src="/GeoJSON"></script>
    <%# import javascript file %>
    <script type="text/javascript">

      //initialize map
      var myLatLng = { lat: 42.3163, lng: -72.6403 };
      var mapOptions = {
          center: myLatLng,
          zoom: 15,
          mapTypeId: google.maps.MapTypeId.ROADMAP

      };

      //create a map
      var map = new google.maps.Map(document.getElementById('googleMap'), mapOptions);


      let station_list = [ 
        {identifier:20,name:"Village Hill/State Hospital",docked_bike_count:6,address:"Village Hill/State Hospital",latitude:42.3137038,longitude:-72.6507563},
        {identifier:21,name:"Florence Bank",docked_bike_count:7,address:"19 Meadow Street Florence MA @ Lilly Library",latitude:42.335499,longitude:-72.673988},
        {identifier:22,name: "YMCA/Childs Park",docked_bike_count:8,address:"YMCA/Childs Park",latitude:42.3289,longitude:-72.6465},
        {identifier:23,name:"Forbes Library",docked_bike_count:6,address:"20 West Street Northampton MA",latitude:42.3167,longitude:-72.638},
        {identifier:24,name:"Florence Center",docked_bike_count:2,address:"31 Main Street Florence MA",latitude:42.3314,longitude:-72.6637},
        {identifier:25,name:"Cooley Dickinson Health Care",docked_bike_count:6,address:"51 Locust Street Northampton MA",latitude:42.3321,longitude:-72.654},
        {identifier:26,name:"John M Greene Hall/Smith College",docked_bike_count:5,address:"1 Chapin Way Northampton MA @ John M. Greene Hall",latitude:42.3194,longitude:-72.6402},
        {identifier:27,name:"Pulaski Park/Downtown",docked_bike_count:3,address:"274 Main Street Northampton MA at Pulaski Park",latitude:42.3172,longitude:-72.6355},
        {identifier:28,name:"Northampton Train Station",docked_bike_count:5,address:"Northampton Train Station",latitude:42.3189,longitude:-72.6286},
        {identifier:29,name:"State St/Mass Central Rail Trail", docked_bike_count:4,address:"State Street/Mass Central Rail Trail",latitude:42.3588,longitude:-71.0564},
        {identifier:30,name:"Jackson Street", docked_bike_count:8,address:"7A-7D Jackson Street Northampton MA",latitude:42.3301,longitude:-72.6453},
        {identifier:31,name:"Main Street/Court House", docked_bike_count:3,address:"99 Main Street Northampton MA",latitude:42.3195,longitude:-72.6328},
        {identifier:32,name:"Main Street/Bridge Street", docked_bike_count:8,address:"1 Bridge Street Northampton MA",latitude:42.3205,longitude:-72.6303},
        {identifier:33,name:"NorthamptonHigh School", docked_bike_count:8,address:"380 Elm Street Northampton MA",latitude:42.3252,longitude:-72.6508}
      ];
      //create marker
      let markerOptions = {
        position: new google.maps.LatLng(42.3163,-72.6403),
        zoom:12,
        mapTypeControlOptions: {
                  mapTypeIds: ["roadmap"]
                }
      }

      //Create markers.
      for (let i = 0; i < station_list.length; i++) {
        const marker = new google.maps.Marker({
          position: new google.maps.LatLng(station_list[i].latitude, station_list[i].longitude),
          // icon: icons[features[i].type].icon,
          map: map
        });

        marker.setMap(map)
        let j = i.toString();
       
        const contentString = `
        
         <% if @stations.present? %>
          <%= render(partial: "stations/row", object: @stations.find_by("20"), as: :station) %>
        <% end %>
        `

        const infowindow = new google.maps.InfoWindow({
          content: contentString,
          ariaLabel: station_list[i].name,
        });

        marker.addListener("click", () => {
          infowindow.open({
            anchor: marker,
            map,
          });
        });

        // infoWindow.open(infoWindowOpenOptions)



      }

      // let marker = new google.maps.Marker(markerOptions);
      // marker.setMap(map)

      // //set up popup information window
      // const infoWindowOptions = {
      //   content: 'Information about the Location, including nearest bike station',
      //   position: myLatLng,
      //   maxWidth: 300
      // }
      // const infoWindow = new google.maps.InfoWindow(infoWindowOptions)
      // const infoWindowOpenOptions = {
      //   map: map,
      //   anchor: marker,
      //   shouldFocus: false
      // }
      
      // //can take html inside the info window to format
      // infoWindow.setContent(`
      //   <h3>Name of the Location</h3>
      //   <div class='alert-info'><br>From: </br> <br>To: </br> <br>Biking distance: </br> <br>Duration : </br><br></br></div>      
      //   <%=link_to "Ride", checkout_path, class: 'btn btn-info btn-lg' %>
      //   <button class="btn btn-info btn-lg "><i class="fas fa-map-signs"></i>QR Code</button>
      // `);

      // infoWindow.open(infoWindowOpenOptions)



      //initialize DirectionsService for route method
      var directionsService = new google.maps.DirectionsService();

      //create DirectionsRenderer for display
      var directionsDisplay = new google.maps.DirectionsRenderer();

      //put DirectionsRenderer on the map
      directionsDisplay.setMap(map);

      // const callback = function (results) {
      //   for (let i = 0; i < results.features.length; i++) {
      //     const coords = results.features[i].geometry.coordinates;
      //     const latLng = new google.maps.LatLng(coords[1], coords[0]);

      //     new google.maps.Marker({
      //       position: latLng,
      //       map: map,
      //     });
      //   }
      // };
      // window.callback = callback;


      //function for calculating the routes and displaying it on the map
      function calcRoute() {
          //create request
          var request = {
              origin: document.getElementById("from").value,
              destination: document.getElementById("to").value,
              travelMode: google.maps.TravelMode.BICYCLING, //DRIVING,WALKING, BYCYCLING, TRANSIT
              unitSystem: google.maps.UnitSystem.IMPERIAL
          }

          //pass the request to the route method
          directionsService.route(request, function (result, status) {
              if (status == google.maps.DirectionsStatus.OK) {

                  //Get distance and time
                  const output = document.querySelector('#output');
                  output.innerHTML = "<div class='alert-info'>From: " + document.getElementById("from").value + ".<br />To: " + document.getElementById("to").value + ".<br /> Biking distance <i class='fas fa-road'></i> : " + result.routes[0].legs[0].distance.text + ".<br />Duration <i class='fas fa-hourglass-start'></i> : " + result.routes[0].legs[0].duration.text + ".</div>";

                  //display route
                  directionsDisplay.setDirections(result);
              } else {
                  //delete route from map
                  directionsDisplay.setDirections({ routes: [] });
                  //center map in London
                  map.setCenter(myLatLng);

                  //show error message
                  output.innerHTML = "<div class='alert-danger'><i class='fas fa-exclamation-triangle'></i> Error occured. Please Try Again.</div>";
              }
          });

      }

      //create autocomplete for the inputs
      var input1 = document.getElementById("from");
      var autocomplete1 = new google.maps.places.Autocomplete(input1);

      var input2 = document.getElementById("to");
      var autocomplete2 = new google.maps.places.Autocomplete(input2);

      // function getMyLocation(){
      //     console.log('Entering getMyLocation');
      //     if(navigator.geolocation){
      //         navigator.geolocation.getCurrentPosition(displayCurrentLocation, displayError, {
      //             maximumAge: 3000, 
      //             // timeout: 5000, 
      //             enableHighAccuracy: true 
      //         });
      //     }
      //     console.log('Exiting getMyLocation');
      // }
      // function displayCurrentLocation(position){
      //     console.log('Entering getCurrentLocation ' );
      //     console.log(position.coords);
      //     var lat = position.coords.latitude;
      //     var lng = position.coords.longitude;
      //     var mapOptions = {
      //         center: new google.maps.LatLng(lat, lng),
      //         zoom: 17
      //     };
      //     var map = new google.maps.Map(document.getElementById("map"),
      //     mapOptions);
      //     var latLng = new google.maps.LatLng(lat, lng);
      //     var marker = new google.maps.Marker({
      //                     position: latLng,
      //                     map: map,
      //                     title: 'Current location'
      //                 });
      //     marker.setMap(map);
      //     console.log('Exiting getCurrentLocation');
          
      // }
    //   function displayError(error){
    //       console.log('Error in getting location');
    //       console.log(error);
    //   }
    // google.maps.event.addDomListener(window, 'load', getMyLocation);

    //   function initMap(position){
    //     let mapOptions = {
    //       // center: {lat: lat,lng: lng},
    //       center: {lat: 41.881832,lng:-87.623177},
    //       zoom: 12
    //     }

    //     let map = new google.maps.Map(document.getElementById('map'), mapOptions);

    //   }

   </script>
    <%# // <div id="container">
    //   <div id = "map">map</div>
    // </div> %>

  </div>

  <div class="jumbotron">
    <b><p><b>How to use our system </b></p></b>
    <div class="row text-center justify-content-center mag5-tb">
            <div class="col-md-12 col-lg-3">
                  <div class = "image">
                    <img src= "assets/join.png">
                  </div>
                  <h2> Join </h2>
                  <div class="text-section">
                        <div class="description">
                          <p></p>
                        </div>
                  </div>
            </div>
            <div class="col-md-12 col-lg-3">
                  <div class = "image">
                    <img src= "assets/ride.png">
                  </div>
                  <h2> Ride </h2>
                  <div class="text-section">
                        <div class="description">
                          <p></p>
                        </div>
                  </div>
            </div>
            <div class="col-md-12 col-lg-3">
                  <div class = "image">
                    <img src= "assets/return.png">
                  </div>
                  <h2> Return </h2>
                  <div class="text-section">
                        <div class="description">
                          <p></p>
                        </div>
                  </div>
            </div>
      </div>


  </div>



  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </div>

</body>
</html>


