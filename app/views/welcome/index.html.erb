<!DOCTYPE html>
<html>
<%# link to css and bootstrap stylesheet %>
<head>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
      <title>ValetBike: Small Freedom with Two Wheels</title>
</head>


<body>
  <div class=header_out></div>
  <div class ="header">
    <div class="inner_header">
      <div class="logo_container">
        <a class="navbar_logo" href="index.html"><h1>VALET<span>BIKE</span></h1></a>
      </div>
      <ul class="navigation">
        <%= link_to('About', about_path, class: 'index-link') %> 
        <%= link_to('Service', service_path, class: 'index-link')  %>

        <% if logged_in? %>
          <%= link_to('Profile', current_user, class: 'index-link') %>
          <%= link_to('Log Out', logout_path, class: 'index-link') %>
          
        <% else %>
          <%= link_to('Log in', sign_in_path, class: 'index-link') %>
          <%= link_to('Sign up', sign_up_path, class: 'index-link') %>
        <% end %>
      </ul>
    </div>
  </div>

  <div class="panel_for_welcome_message">
    <div class="welcome_message"> <h1>Ride With the Wind, Share Your Freedom </h1></div>  
  <div>

  <div class="jumbotron">
    <div class="container-fluid">
        <p>Start Riding</p>
        <form class="form-horizontal">
            <div class="form-group">
                <label for="from" class="col-xs-2 control-label"><i class="far fa-dot-circle"></i></label>
                <div class="col-xs-4">
                    <input type="text" id="from" placeholder="Origin" class="form-control">
                </div>
          </div>
          <div class="form-group">
            
                <label for="to" class="col-xs-2 control-label"><i class="fas fa-map-marker-alt"></i></label>
                <div class="col-xs-4">
                    <input type="text" id="to" placeholder="Destination" class="form-control">
                </div>
              
            </div>
            
        </form>

        <div class="form-group">
            <button class="btn btn-info btn-lg " onclick="calcRoute();"><i class="fas fa-map-signs"></i>Go</button>
        </div>


    </div>
    <%# <% <div class="container-fluid">
        <div id="googleMap"></div>
        <div id="output"></div>
    </div> %>
    <div id="map" style="width: 1000px; height: 500px;"></div>

    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDfTjL083Zn1BlzvCMq1xOv_M53aYGFIZU&libraries=places"></script>
    <script src="/GeoJSON" type="application/json"></script>
     <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>

    <%# import javascript file %>
  
    <script type="text/javascript">
        var myLocation;
        const map = new google.maps.Map(document.getElementById("map"),{
          zoom: 15,
          center: new google.maps.LatLng(42.3163, -72.6403),
          mapTypeId: google.maps.MapTypeId.ROADMA
        });
        
        
        $.getJSON("/GeoJSON",function(data, status){   
            for (let i = 0; i < data.length; i++) {
              const latLng = new google.maps.LatLng(data[i].geometry.coordinates[0], data[i].geometry.coordinates[1]);
              const contentString = 
                '<div class="alert-info">'+
                '<br>Station: </br>'+ data[i].properties.name+
                '<br>Duration : </br>'+
                '<br>Biking distance: </br>'+ 
                '<br>Duration : </br><br></br></div>'
               
                ;

              const infowindow = new google.maps.InfoWindow({
                content: contentString
                });
              const marker = new google.maps.Marker({
                      position: latLng,
                      map: map,
                    });
              marker.addListener("click", () => {
                    infowindow.open({
                      anchor: marker,
                      map,
                    });
              }); 
            
            };
          });
        

      

      //function for calculating the routes and displaying it on the map
      function calcRoute() {
          //create request
          var request = {
              origin: document.getElementById("from").value,
              destination: document.getElementById("to").value,
              travelMode: google.maps.TravelMode.BICYCLING, //DRIVING,WALKING, BYCYCLING, TRANSIT
              unitSystem: google.maps.UnitSystem.IMPERIAL
          };
          var directionsService = new google.maps.DirectionsService();
          //pass the request to the route method
          directionsService.route(request, function (result, status) {
              if (status == google.maps.DirectionsStatus.OK) {

                  //Get distance and time
                  const output = document.querySelector('#output');
                  output.innerHTML = "<div class='alert-info'>From: " + document.getElementById("from").value + ".<br />To: " + document.getElementById("to").value + ".<br /> Biking distance <i class='fas fa-road'></i> : " + result.routes[0].legs[0].distance.text + ".<br />Duration <i class='fas fa-hourglass-start'></i> : " + result.routes[0].legs[0].duration.text + ".</div>";

                  //display route
                  directionsDisplay.setDirections(result);
              } else {
                  //delete route from map
                  directionsDisplay.setDirections({ routes: [] });
                  //center map in London
                  map.setCenter(myLatLng);

                  //show error message
                  output.innerHTML = "<div class='alert-danger'><i class='fas fa-exclamation-triangle'></i> Error occured. Please Try Again.</div>";
              }
          });
      }

        //function for calculating the routes and displaying it on the map
     

      //create autocomplete for the inputs
      var input1 = document.getElementById("from");
      var autocomplete1 = new google.maps.places.Autocomplete(input1);

      var input2 = document.getElementById("to");
      var autocomplete2 = new google.maps.places.Autocomplete(input2);

      // function getMyLocation(){
      //     console.log('Entering getMyLocation');
      //     if(navigator.geolocation){
      //         navigator.geolocation.getCurrentPosition(displayCurrentLocation, displayError, {
      //             maximumAge: 3000, 
      //             // timeout: 5000, 
      //             enableHighAccuracy: true 
      //         });
      //     }
      //     console.log('Exiting getMyLocation');
      // }
      // function displayCurrentLocation(position){
      //     console.log('Entering getCurrentLocation ' );
      //     console.log(position.coords);
      //     var lat = position.coords.latitude;
      //     var lng = position.coords.longitude;
      //     var mapOptions = {
      //         center: new google.maps.LatLng(lat, lng),
      //         zoom: 17
      //     };
      //     var map = new google.maps.Map(document.getElementById("map"),
      //     mapOptions);
      //     var latLng = new google.maps.LatLng(lat, lng);
      //     var marker = new google.maps.Marker({
      //                     position: latLng,
      //                     map: map,
      //                     title: 'Current location'
      //                 });
      //     marker.setMap(map);
      //     console.log('Exiting getCurrentLocation');
          
      // }
    //   function displayError(error){
    //       console.log('Error in getting location');
    //       console.log(error);
    //   }
    // google.maps.event.addDomListener(window, 'load', getMyLocation);

    //   function initMap(position){
    //     let mapOptions = {
    //       // center: {lat: lat,lng: lng},
    //       center: {lat: 41.881832,lng:-87.623177},
    //       zoom: 12
    //     }

    //     let map = new google.maps.Map(document.getElementById('map'), mapOptions);

    //   }

   </script>

  </div>
  <hr>
  
  <div class="jumbotron">
    <div class="description"><p><b>How to use our system</b></p></div>
    <div class="row text-center justify-content-center mag5-tb">
            <div class="col-md-12 col-lg-3">
            <div class="column">
            <div class="card">
                  <div class = "image">
                    <img src= "assets/join.png">
                  </div>
                  <h2> Join </h2>
                  <div class="text-section">
                        <div class="description">
                          <p>To start riding simply sign up in the website or directly through the kiosk! Choose your own membership or even just start a simple trip. Enjoy your journey!</p>
                        </div>
                  </div>
                  </div>
                  </div>
            </div>
            <div class="col-md-12 col-lg-3">
            <div class="column">
            <div class="card">
                  <div class = "image">
                    <img src= "assets/ride.png">
                  </div>
                  <h2> Ride </h2>
                  <div class="text-section">
                        <div class="description">
                          <p> Unlock the bike using your membership or just purchase a single pass. Please be careful on the road and enjoy the ride!</p>
                        </div>
                  </div>
            </div>
            </div>
            </div>
            <div class="col-md-12 col-lg-3">
            <div class="column">
            <div class="card">
                  <div class = "image">
                    <img src= "assets/return.png">
                  </div>
                  <h2> Return </h2>
                  <div class="text-section">
                        <div class="description">
                          <p>Keep your ride within the time to avoid extra fees. Return the bike by docking at any station. Listen to the sound to confirm and check bike screen for the notification.</p>
                        </div>
                  </div>
            </div>
            </div>
            </div>
      </div>


  </div>



  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </div>

</body>
</html>


