<div class="page-section flexbox vertical stretch">
  <div class="section-inner flexbox vertical stretch">
    <div class='nav-brand'>
</div>
    <div class="section-title">

    </div>
    <div class="flexbox vertical stretch">
      <head>
        <style>
          #map {
            height: 600px;
            width: 100%;
          }
        </style>
      </head>
      <body>
        <h3>GFG Google Maps Demo</h3>
        <div id="map"></div>
        <script>
          function initMap() {
            var uluru = {lat: 42.3163, lng: -72.6403};
            var map = new google.maps.Map(document.getElementById('map'), {
              zoom: 14,
              center: new google.maps.LatLng(42.3163, -72.6403)
            });

            const image = {
              url: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAABmJLR0QA/wD/AP+gvaeTAAAEZElEQVRIieWWW2xUVRSGv7XPTNuZzjBDbai0aIImEi4BUYMMnZaLYjFCjIQxpBjxwTsQX00wahR8wITIiyaaGIhCYjtpAgEjbWmRAlODUEkQhISLglwEaqedMqWdc5YPM0NK6XTEYHhgPZ2z8p//X/8+a6+9pa6uzuIuhLkbovemsOtOEc3fs6RVRKqy76q6r6k6OjsX/o45FpFxNyfQkfA5Hc/fs+RHEakcnBvRhfAdyrsIXzaG69/OV+jtOR7BhWOxJV0dS0LnQgX/WbipOjpbXcwBFEgOuK9PaKqKzsmFbw7VH1XVw0CJ58zYBfmEJd8AqWmLfK3wcj6im1mJNobrl44EybvUNvYPtyUKoCwMxWoCI0HybifB3GgUhQsJV/eUWGhnfDCmquPZEk/CdxLwA6eB8d6B4heAjbl4R3RcE4s8LkgY+NtB2wXG+p1Ra4biinp9qwA/QqMt9icAlrGWjWgo+4/DR8OFns6y13CkVkQmA/3AADAGw6eO4RuT4iBgiZvKnTPrDwCEYjUBf2rUSSBoXFQnPb0nCnuKzwMCXANwVI+I6JbE+PNfxcbF+m84Dh9cVOG5en9M1HwmIjOAYmA0MAZAHX06KckuDOsB4/TrF9MvTncB+GzfCiAI7O6R5JmCbu+2DK9keIqNyJOC2eA7VbG/sn1hOYC1YfIGj6c7uEuQqQpHbbHfiN/X/aa3r8gDzARsQcrdtmt2ry/xVkF/YUREJhZ1BrtKrlQc8Q54NwNeR+wVBSn355nCrwBeVT3cVRqf6E66DxjMNBGZ4nZcc8qswCbjuVr2uiBTUY4lXN1VLeGGbU5SVZXlAKr2YuC0iDzm7S1e6mC/A2BhPihJjv4YKHXQ/SAPZkSPD1jXpgKdIjItEA8+0FLVsLXH1V0J/CbIdN+Z8lcNSC1Aytirs91akgy8AgQV3dtU3bBDsT8EQKW2uarhewwNgF+UVem8swaV5QC2sVe3ztrxF0IUwNjUAsRCO+O2sd9Lw2WZEWQiQE9JT+uNjtP0FhIk/ExbJCVYm9INIbOeaYukcFicxSp6oLm6odEgEwCumd5WAM2OUIcXs9iEJ9ECYEQmGbh1/qrqpaG5HNHnkHZBZiakAo4D8Etg9z5H9SdFO7Ngc10k++xS1WMiMsN/1T8P2ArQVB2dO5h9/t7FL4laGx20vbkqGh6ugqE8lydd1maiN51u3lTxvPQi6K8G0c3pcq21w425uT8/VyaO9T4Aot/m9J6HZ1bHgqCFtTZT5mY5u/6sx3eqYr+IPAoct429OuFJtHj73EWWFs41jvUR8LCqHko89Gc4OwCGRuhcqGA4HgBfr++pjOgjqnqoq/T3Sqmrq7Mq2xeWe/uLtmU+unUZ0Q7b1beoJbT9Yk7HQF4e1UOOt+/5XU9sv2BFIhFzdtyJnjIrsLEg7rukMFqQIDDgqHZgdF1i/PmVbZNb4sORDY4cPP2O6kEVXRcv/WPl3mm74/AvzuP/K+69e/W9J/wPPz7PXmCmUJkAAAAASUVORK5CYII',
              size: new google.maps.Size(30, 30),
              origin: new google.maps.Point(0, 0),
              anchor: new google.maps.Point(0, 30),
            };
            const shape = {
              coords: [1, 1, 1, 20, 18, 20, 18, 1],
              type: "poly",
            };


            var geocoder = new google.maps.Geocoder();
            var station_addresses = <%= raw Station.all.map(&:address).to_json %>;
            var station_bike_numbers = <%= raw Station.all.map(&:docked_bike_count).to_json %>;
            var station_dock_numbers = <%= raw Station.all.map(&:dock_count).to_json %>;
            for (let index = 0; index < station_addresses.length; index++){
              geocoder.geocode( { 'address': station_addresses[index]}, function(results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                  var latitude = results[0].geometry.location.lat();
                  var longitude = results[0].geometry.location.lng();
                  var marker = new google.maps.Marker({
                    position: new google.maps.LatLng(latitude, longitude),
                    map: map,
                    icon: image,
                    shape: shape
                  });
                  function getInfoCallback(map, station_addresses, index) {
                    var infowindow = new google.maps.InfoWindow();
                    return function () {
                        infowindow.setContent(station_addresses[index]+ "<br />" +"Available Bike: " + station_bike_numbers[index] + "<br />" +"Available Dock: " + station_dock_numbers[index]);
                        infowindow.open(map, this);
                    };
                  };
                  google.maps.event.addListener(marker, 'click', getInfoCallback(map, station_addresses, index));
                }
              });
            }
          }



        </script>
        <script async defer
        src=
    "https://maps.googleapis.com/maps/api/js?key=
    AIzaSyCPqY9_FRwOslLVcWVLbUcHAEy6U88UWTI&callback=initMap">
        </script>
      </body>
      <% if @stations.present? %>
        <%= render(partial: "stations/row") %>
      <% else %>
      <div class="empty">
        No stations found.
      </div>
      <% end %>
    </div>
	</div>
