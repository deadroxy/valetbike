<!-- displays stations and number of docked bikes at each station -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
    <title>Display a map on a webpage</title>
      <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  </head>
<body>

<div class= "map-container">
  <div id= "mapdesc">
    <div class="page-section flexbox vertical stretch">
      <div class="section-inner flexbox vertical stretch">
        <div class="section-title flexbox horizontal center">
        <h1>Checkout Our Stations Around the Pioneer Valley!</h1>
        </div>
        <p> Renting a bike could not be more simple. Search for a station near your location or click on a station marker below.</p>
        <div id="mapSidebar" class="sidebar">
          <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
            <% if @stations.present? %>
              <%= render(partial: "home/row", collection: @stations, as: :station) %>
            <% else %>
              <div class="empty">
                No stations found.
              </div>
            <% end %>
        </div>
            <div id= "stationview">
              <button class="openbtn" onclick="openNav()">&#9776; View Stations </button>
                <script>
                function openNav() {
                  document.getElementById("mapSidebar").style.width = "250px";
                  document.getElementById("stationview").style.marginLeft = "250px";
                }

                function closeNav() {
                  document.getElementById("mapSidebar").style.width = "0";
                  document.getElementById("stationview").style.marginLeft = "0";
                }

                </script>
            </div>
    </div>
  </div>
</div>



<div id="map"></div>

<script>
	mapboxgl.accessToken = 'pk.eyJ1IjoieWxvbzEyMyIsImEiOiJjbG9sdDJxYjAwdHR2Mmxxb2FsaG9nN2lvIn0.OZGWalV5uPOOaCrC7TwbWg';
    const map = new mapboxgl.Map({
    container: 'map', // container ID
    style: 'mapbox://styles/mapbox/streets-v12', // style URL
    center: [-72.64, 42.325], // starting position [lng, lat]
    zoom: 11.5 // starting zoom
  });
  
  //iterates all stations, creating new location marker for each using longitude and latitude attributes 
  <% @stations.each do |station| %>
    new mapboxgl.Marker({color: 'orange'})
      .setLngLat([<%= station.longitude %>, <%= station.latitude %>])
      .setPopup(
      new mapboxgl.Popup({ offset: 25 }) 
      .setHTML("<h3><%=station.name%></h3><p>Docked Bike Count: <%=station.docked_bikes.count%></p>")
    )   
  .addTo(map); 
<%end%> 
</script> 


</div>
</body>
</html>






